<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bill Splitter</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Cropper.js for image cropping -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.css">
    <script src="https://cdn.jsdelivr.net/npm/cropperjs@1.6.1/dist/cropper.min.js"></script>
    <!-- Tesseract.js for OCR -->
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ½ï¸ Bill Splitter</h1>
            <p class="subtitle">Tap or drag dishes to assign them to people</p>
        </header>

        <!-- Restaurant Info Section -->
        <section class="card restaurant-info">
            <h2>Restaurant Details</h2>
            <div class="form-grid">
                <div class="form-group">
                    <label for="restaurantName">Restaurant Name</label>
                    <input type="text" id="restaurantName" placeholder="Enter restaurant name">
                </div>
                <div class="form-group">
                    <label for="totalAmount">Total Amount</label>
                    <input type="number" id="totalAmount" placeholder="0" min="0">
                </div>
                <div class="form-group">
                    <label for="discountedAmount">Discounted (Final) Amount <span class="required">*</span></label>
                    <input type="number" id="discountedAmount" placeholder="0" min="0" required>
                </div>
                <div class="form-group">
                    <label for="cashback">Cashback (append % for percentage)</label>
                    <input type="text" id="cashback" placeholder="0 or 10%">
                </div>
            </div>
            <div class="calculated-info">
                <span id="finalAmount">Final Amount: â‚¹0</span>
            </div>
        </section>

        <!-- Bill Scanner Section -->
        <section class="card scanner-section">
            <div class="section-header">
                <h2>ğŸ“¸ Scan Bill (Optional)</h2>
            </div>
            <div class="scan-tip">
                <strong>ğŸ’¡ Tip:</strong> Take a clear photo of your bill. Works best with printed receipts.
            </div>
            
            <div class="upload-buttons">
                <button class="btn btn-primary upload-btn" id="uploadBtn">ğŸ“ Upload Image</button>
                <button class="btn btn-primary upload-btn" id="cameraBtn">ğŸ“· Take Photo</button>
            </div>
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“„</div>
                <p>Drop image here or <strong>Ctrl+V</strong> to paste</p>
                <small>Supports JPG, PNG, WEBP</small>
                <input type="file" id="billInput" class="file-input" accept="image/*">
                <input type="file" id="cameraInput" class="file-input" accept="image/*" capture="environment">
            </div>

            <div class="preview-container" id="previewContainer">
                <div class="crop-container" id="cropContainer">
                    <img id="imagePreview" class="image-preview" alt="Bill preview">
                </div>
                <div class="crop-hint">
                    <strong>âœ‚ï¸ Crop to items only</strong> - Drag to select the area with dish names and prices for better accuracy
                </div>
                <div class="scan-actions">
                    <button class="btn btn-success" id="cropBtn">âœ‚ï¸ Crop & Scan</button>
                    <button class="btn btn-primary" id="scanFullBtn">ğŸ” Scan Full Image</button>
                    <button class="btn btn-secondary" id="clearScanBtn">Clear</button>
                </div>
            </div>

            <div class="progress-container" id="progressContainer">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <p class="progress-text" id="progressText">Initializing...</p>
            </div>

            <div class="scan-results" id="scanResults">
                <h3>Detected Items (edit if needed):</h3>
                <div class="detected-items" id="detectedItems"></div>
                <div class="results-actions">
                    <button class="btn btn-success" id="addDetectedBtn">âœ“ Add Selected Items</button>
                    <button class="btn btn-secondary" id="cancelResultsBtn">Cancel</button>
                </div>
            </div>
        </section>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- People Section -->
            <section class="card people-section">
                <div class="section-header">
                    <h2>ğŸ‘¥ People</h2>
                    <button class="btn btn-primary" id="addPersonBtn">+ Add Person</button>
                </div>
                <div class="add-person-form" id="addPersonForm" style="display: none;">
                    <input type="text" id="newPersonName" placeholder="Enter name">
                    <button class="btn btn-success" id="confirmAddPerson">Add</button>
                    <button class="btn btn-secondary" id="cancelAddPerson">Cancel</button>
                </div>
                <div class="people-list" id="peopleList">
                    <p class="empty-state">No people added yet</p>
                </div>
            </section>

            <!-- Dishes Section -->
            <section class="card dishes-section">
                <div class="section-header">
                    <h2>ğŸ• Dishes</h2>
                    <button class="btn btn-primary" id="addDishBtn">+ Add Dish</button>
                </div>
                <div class="add-dish-form" id="addDishForm" style="display: none;">
                    <input type="text" id="newDishName" placeholder="Dish name">
                    <input type="number" id="newDishPrice" placeholder="Price" min="0">
                    <button class="btn btn-success" id="confirmAddDish">Add</button>
                    <button class="btn btn-secondary" id="cancelAddDish">Cancel</button>
                </div>
                <div class="dishes-list" id="dishesList">
                    <p class="empty-state">No dishes added yet</p>
                </div>
                <div class="dishes-total">
                    <span>Dishes Total: </span>
                    <span id="dishesTotal">â‚¹0</span>
                </div>
            </section>
        </div>

        <!-- Drop Zones for People -->
        <section class="card assignments-section">
            <h2>ğŸ“‹ Assignments</h2>
            <p class="hint">Tap a dish above, then tap people below to assign (or drag on desktop)</p>
            <div class="assignments-grid" id="assignmentsGrid">
                <p class="empty-state">Add people to see assignment zones</p>
            </div>
        </section>

        <!-- Summary Section -->
        <section class="card summary-section">
            <div class="section-header">
                <h2>ğŸ’° Summary</h2>
                <button class="btn btn-primary" id="copyBtn">ğŸ“‹ Copy Summary</button>
            </div>
            <div class="summary-content" id="summaryContent">
                <p class="empty-state">Add people and assign dishes to see the summary</p>
            </div>
        </section>
    </div>

    <div class="toast" id="toast"></div>

    <!-- Mobile Assignment Modal -->
    <div class="modal-overlay" id="assignModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="modalDishName">Assign Dish</h3>
                <button class="modal-close" id="closeModal">âœ•</button>
            </div>
            <p class="modal-hint">Select people to share this dish:</p>
            <div class="modal-people" id="modalPeople"></div>
            <button class="btn btn-primary modal-done" id="modalDone">Done</button>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
